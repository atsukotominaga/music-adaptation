---
title: 'Primary analysis'
output:
  html_notebook: default
editor_options: 
  chunk_output_type: inline
---

Description: This is a summary of primary analysis.

- Last checked: `r format(Sys.Date(), "%d-%b-%Y")`

# Outline
- IOIs
- KOT
- KV
- KV-Diff

```{r setup, include = FALSE}
# packages
# data manipulation
if (!require("data.table")) {install.packages("data.table"); require("data.table")}
# plot
if (!require("ggpubr")) {install.packages("ggpubr"); require("ggpubr")}
```

```{r file, include = FALSE}
filename = "filtered/dt_correct_onset_1.txt"
```

```{r extract, include = FALSE}
data <- fread(filename, header = T, sep = ",", dec = ".") # read a trimmed csv

# SubNr as a factor
data$SubNr <- as.factor(data$SubNr)

# assign stimuli categories
data$Stimuli <- as.numeric(gsub(".mid", "", data$Stimuli))
data$Category <- "NA"
data[Stimuli < 5]$Category <- "art_only"
data[Stimuli > 4 & Stimuli < 9]$Category <- "dyn_only"
data[Stimuli > 8 & Stimuli < 13]$Category <- "high"
data[Stimuli > 12]$Category <- "low"

# assign articulation (yes/no) & dynamics (yes/no)
data$Articulation <- "NA"
data$Dynamics <- "NA"
data[Category == "art_only"]$Articulation <- "Present"
data[Category == "art_only"]$Dynamics <- "Absent"
data[Category == "dyn_only"]$Articulation <- "Absent"
data[Category == "dyn_only"]$Dynamics <- "Present"
data[Category == "high"]$Articulation <- "Present"
data[Category == "high"]$Dynamics <- "Present"
data[Category == "low"]$Articulation <- "Absent"
data[Category == "low"]$Dynamics <- "Absent"

# IOIs
dt_ioi <- data
dt_ioi$IOI <- diff(c(0, dt_ioi$TimeStamp))

# remove the first note
dt_ioi <- dt_ioi[RowNr != 1]

# assign Interval
dt_ioi$Interval <- rep(1:71, nrow(dt_ioi)/71)

# define intervals
ls_l_f <- list(c(1:4), c(9:16), c(21:24), c(40:46))
ls_s_p <- list(c(6:7), c(18:19), c(29:31), c(36:38), c(48:50), c(53:55), c(58:64))
change_1 <- c(5, 17, 47) # legato to staccato / forte to piano
change_2 <- c(8, 20, 39) # staccato to legato / piano to forte

# assign Subcomponents
dt_ioi$Subcomponent <- "NA"
# legato & forte
for (phrase in 1:length(ls_l_f)){
  for (note in 1:length(ls_l_f[[phrase]])){
    dt_ioi[Interval == ls_l_f[[phrase]][note]]$Subcomponent <- "L-F"
  }
}
# staccato & piano
for (phrase in 1:length(ls_s_p)){
  for (note in 1:length(ls_s_p[[phrase]])){
    dt_ioi[Interval == ls_s_p[[phrase]][note]]$Subcomponent <- "S-P"
  }
}
for (number in change_1){
  dt_ioi[Interval == number]$Subcomponent <- "LFtoPS"
}
for (number in change_2){
  dt_ioi[Interval == number]$Subcomponent <- "SPtoLF"
}

# KOT

# KV
dt_vel <- data
dt_vel$Diff <- diff(c(0, dt_vel$Velocity))

# remove the first note
dt_vel_diff <- dt_vel[RowNr != 1]
dt_vel$Diff <- NULL # remove Diff from dt_vel

# assign Interval
dt_vel_diff$Interval <- rep(1:71, nrow(dt_vel_diff)/71)

# for each note (velocity)
ls_l_f_2 <- list(c(1:5), c(9:17), c(21:26), c(40:47))
ls_s_p_2 <- list(c(6:8), c(18:20), c(29:32), c(36:39), c(48:51), c(53:56), c(58:65))

# assign Subcomponents
# for each note
dt_vel$Subcomponent <- "NA"
# legato & forte
for (phrase in 1:length(ls_l_f_2)){
  for (note in 1:length(ls_l_f_2[[phrase]])){
    dt_vel[RowNr == ls_l_f_2[[phrase]][note]]$Subcomponent <- "L-F"
  }
}
# staccato & piano
for (phrase in 1:length(ls_s_p_2)){
  for (note in 1:length(ls_s_p_2[[phrase]])){
    dt_vel[RowNr == ls_s_p_2[[phrase]][note]]$Subcomponent <- "S-P"
  }
}

dt_vel_diff$Subcomponent <- "NA"
# legato & forte
for (phrase in 1:length(ls_l_f)){
  for (note in 1:length(ls_l_f[[phrase]])){
    dt_vel_diff[Interval == ls_l_f[[phrase]][note]]$Subcomponent <- "L-F"
  }
}
# staccato & piano
for (phrase in 1:length(ls_s_p)){
  for (note in 1:length(ls_s_p[[phrase]])){
    dt_vel_diff[Interval == ls_s_p[[phrase]][note]]$Subcomponent <- "S-P"
  }
}
for (number in change_1){
  dt_vel_diff[Interval == number]$Subcomponent <- "LFtoSP"
}
for (number in change_2){
  dt_vel_diff[Interval == number]$Subcomponent <- "SPtoLF"
}
```

# IOI 
## 1. Individual

```{r ioi, echo = FALSE}
# for each individual
ioi <- dt_ioi[Subcomponent != "NA", .(N = .N, Mean = mean(IOI), SD = sd(IOI)), by = .(SubNr, Stimuli, Articulation, Dynamics)]
ioi <- ioi[order(SubNr, Stimuli, Articulation, Dynamics)]
ioi
```

### Plot
#### Boxplot

```{r ioi-plot, echo = FALSE, fig.width = 4.5}
ggboxplot(ioi[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation, Dynamics)], "Articulation", "Mean", color = "Dynamics", facet.by = "SubNr", xlab = "Articulation", ylab = "IOIs (ms)", title = "IOI")
```

## 2. All - group

```{r ioi-all, echo = FALSE}
# group mean
ioi_all <- ioi[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation, Dynamics)]
ioi_all <- ioi_all[order(Articulation, Dynamics)]
ioi_all
```

### Plot
#### Box plot

```{r ioi-all-plot, echo = FALSE}
ggboxplot(ioi[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Articulation, Dynamics)], "Articulation", "Mean", color = "Dynamics", xlab = "Articulation", ylab = "IOIs (ms)", title = "IOI")
```

# Dynamics
## 1. Individual
```{r vel, echo = FALSE}
# for each individual
vel <- dt_vel[Subcomponent != "NA", .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Stimuli, Articulation, Dynamics, Subcomponent)]
vel <- vel[order(SubNr, Stimuli, Articulation, Dynamics)]
vel
```

### Plot
#### Boxplot

```{r vel-plot,  echo = FALSE, fig.width = 4.5}
ggboxplot(vel[Subcomponent == "L-F", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", facet.by = "SubNr", xlab = "SubNr", ylab = "Velocity", title = "KV (Forte)")
ggboxplot(vel[Subcomponent == "S-P", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", facet.by = "SubNr", xlab = "SubNr", ylab = "Velocity", title = "KV (Piano)")
```

## 2. All - group
```{r vel-all, echo = FALSE}
# group mean
vel_all <- vel[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation, Dynamics, Subcomponent)]
vel_all <- vel_all[order(Articulation, Dynamics, Subcomponent)]
vel_all
```

### Plot
#### Boxplot

```{r vel-all-plot,  echo = FALSE}
ggboxplot(vel[Subcomponent == "L-F", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", xlab = "Dynamics", ylab = "Velocity", title = "KV (Forte)")
ggboxplot(vel[Subcomponent == "S-P", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", xlab = "Dynamics", ylab = "Velocity", title = "KV (Piano)")
```

# KV-Diff
## 1. Individual

```{r vel-diff, echo = FALSE}
# for each individual
vel_diff <- dt_vel_diff[Subcomponent == "LFtoSP" | Subcomponent == "SPtoLF", .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, Stimuli, Articulation, Dynamics, Subcomponent)]
vel_diff <- vel_diff[order(SubNr, Stimuli, Articulation, Dynamics, Subcomponent)]
vel_diff
```

### Plot
#### Boxplot

```{r vel-diff-plot, echo = FALSE, fig.width = 4.5}
ggboxplot(vel_diff[Subcomponent == "LFtoSP", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", facet.by = "SubNr", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV-Diff (LFtoSP)")
ggboxplot(vel_diff[Subcomponent == "SPtoLF", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", facet.by = "SubNr", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV-Diff (SPtoLF)")
```

## 2. All - group
```{r vel-diff-all, echo = FALSE}
# group mean
vel_diff_all <- vel_diff[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation, Dynamics, Subcomponent)]
vel_diff_all <- vel_diff_all[order(Articulation, Dynamics, Subcomponent)]
vel_diff_all
```

### Plot
#### Boxplot

```{r vel-diff-all-plot,  echo = FALSE}
ggboxplot(vel_diff[Subcomponent == "LFtoSP", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV (LF to SP)")
ggboxplot(vel_diff[Subcomponent == "SPtoLF", .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(Stimuli, Articulation, Dynamics)], "Dynamics", "Mean", color = "Articulation", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV (SP to LF)")
```
