---
title: 'Analysis only with the first instance'
output:
  html_notebook: default
editor_options: 
  chunk_output_type: inline
---

Description: This is a summary of analysis which only include the performance with the first instance of each student (category).

- Last checked: `r format(Sys.Date(), "%d-%b-%Y")`

```{r setup, include = FALSE}
# set chunk option
knitr::opts_chunk$set(echo = FALSE)

# packages
# data manipulation
if (!require("data.table")) {install.packages("data.table"); require("data.table")}
# stats
if (!require("afex")) {install.packages("afex"); require("afex")}
# plot
if (!require("ggpubr")) {install.packages("ggpubr"); require("ggpubr")}
```

```{r file, include = FALSE}
data_ioi = "preprosessor/trimmed/dt_ioi_trimmed.txt"
data_kot = "preprosessor/trimmed/dt_kot_trimmed.txt"
data_vel = "preprosessor/trimmed/dt_vel_trimmed.txt"
data_vel_diff = "preprosessor/trimmed/dt_vel_diff_trimmed.txt"
```

```{r prep, include = FALSE}
dt_ioi <- fread(data_ioi, header = T, sep = ",", dec = ".")
dt_kot <- fread(data_kot, header = T, sep = ",", dec = ".")
dt_vel <- fread(data_vel, header = T, sep = ",", dec = ".")
dt_vel_diff <- fread(data_vel_diff, header = T, sep = ",", dec = ".")

# SubNr as a factor
dt_ioi$SubNr <- as.factor(dt_ioi$SubNr)

# assign stimuli categories
dt_ioi$Stimuli <- as.numeric(gsub(".mid", "", dt_ioi$Stimuli))
dt_ioi$Articulation2 <- "NA"
dt_ioi$Dynamics2 <- "NA"
dt_ioi$Category <- "NA"
dt_ioi[Stimuli < 5]$Articulation2 <- "Present"
dt_ioi[Stimuli < 5]$Dynamics2 <- "Absent"
dt_ioi[Stimuli < 5]$Category <- "art_only"
dt_ioi[Stimuli > 4 & Stimuli < 9]$Articulation2 <- "Absent"
dt_ioi[Stimuli > 4 & Stimuli < 9]$Dynamics2 <- "Present"
dt_ioi[Stimuli > 4 & Stimuli < 9]$Category <- "dyn_only"
dt_ioi[Stimuli > 8 & Stimuli < 13]$Articulation2 <- "Present"
dt_ioi[Stimuli > 8 & Stimuli < 13]$Dynamics2 <- "Present"
dt_ioi[Stimuli > 8 & Stimuli < 13]$Category <- "both"
dt_ioi[Stimuli > 12]$Articulation2 <- "Absent"
dt_ioi[Stimuli > 12]$Dynamics2 <- "Absent"
dt_ioi[Stimuli > 12]$Category <- "none"

dt_kot$Stimuli <- as.numeric(gsub(".mid", "", dt_kot$Stimuli))
dt_kot$Articulation2 <- "NA"
dt_kot$Dynamics2 <- "NA"
dt_kot$Category <- "NA"
dt_kot[Stimuli < 5]$Articulation2 <- "Present"
dt_kot[Stimuli < 5]$Dynamics2 <- "Absent"
dt_kot[Stimuli < 5]$Category <- "art_only"
dt_kot[Stimuli > 4 & Stimuli < 9]$Articulation2 <- "Absent"
dt_kot[Stimuli > 4 & Stimuli < 9]$Dynamics2 <- "Present"
dt_kot[Stimuli > 4 & Stimuli < 9]$Category <- "dyn_only"
dt_kot[Stimuli > 8 & Stimuli < 13]$Articulation2 <- "Present"
dt_kot[Stimuli > 8 & Stimuli < 13]$Dynamics2 <- "Present"
dt_kot[Stimuli > 8 & Stimuli < 13]$Category <- "both"
dt_kot[Stimuli > 12]$Articulation2 <- "Absent"
dt_kot[Stimuli > 12]$Dynamics2 <- "Absent"
dt_kot[Stimuli > 12]$Category <- "none"

dt_vel$Stimuli <- as.numeric(gsub(".mid", "", dt_vel$Stimuli))
dt_vel$Articulation2 <- "NA"
dt_vel$Dynamics2 <- "NA"
dt_vel$Category <- "NA"
dt_vel[Stimuli < 5]$Articulation2 <- "Present"
dt_vel[Stimuli < 5]$Dynamics2 <- "Absent"
dt_vel[Stimuli < 5]$Category <- "art_only"
dt_vel[Stimuli > 4 & Stimuli < 9]$Articulation2 <- "Absent"
dt_vel[Stimuli > 4 & Stimuli < 9]$Dynamics2 <- "Present"
dt_vel[Stimuli > 4 & Stimuli < 9]$Category <- "dyn_only"
dt_vel[Stimuli > 8 & Stimuli < 13]$Articulation2 <- "Present"
dt_vel[Stimuli > 8 & Stimuli < 13]$Dynamics2 <- "Present"
dt_vel[Stimuli > 8 & Stimuli < 13]$Category <- "both"
dt_vel[Stimuli > 12]$Articulation2 <- "Absent"
dt_vel[Stimuli > 12]$Dynamics2 <- "Absent"
dt_vel[Stimuli > 12]$Category <- "none"

dt_vel_diff$Stimuli <- as.numeric(gsub(".mid", "", dt_vel_diff$Stimuli))
dt_vel_diff$Articulation2 <- "NA"
dt_vel_diff$Dynamics2 <- "NA"
dt_vel_diff$Category <- "NA"
dt_vel_diff[Stimuli < 5]$Articulation2 <- "Present"
dt_vel_diff[Stimuli < 5]$Dynamics2 <- "Absent"
dt_vel_diff[Stimuli < 5]$Category <- "art_only"
dt_vel_diff[Stimuli > 4 & Stimuli < 9]$Articulation2 <- "Absent"
dt_vel_diff[Stimuli > 4 & Stimuli < 9]$Dynamics2 <- "Present"
dt_vel_diff[Stimuli > 4 & Stimuli < 9]$Category <- "dyn_only"
dt_vel_diff[Stimuli > 8 & Stimuli < 13]$Articulation2 <- "Present"
dt_vel_diff[Stimuli > 8 & Stimuli < 13]$Dynamics2 <- "Present"
dt_vel_diff[Stimuli > 8 & Stimuli < 13]$Category <- "both"
dt_vel_diff[Stimuli > 12]$Articulation2 <- "Absent"
dt_vel_diff[Stimuli > 12]$Dynamics2 <- "Absent"
dt_vel_diff[Stimuli > 12]$Category <- "none"
```

```{r, include = FALSE}
info <- dt_ioi[, .(N = .N), by = .(SubNr, TrialNr, Stimuli, Category)]
info

dt_ioi_first <- data.table()
for (subnr in unique(info$SubNr)){
  for (category in unique(info[SubNr == subnr]$Category)){
    trials <- unique(info[SubNr == subnr & Category == category]$TrialNr)
    current <- dt_ioi[SubNr == subnr & Category == category & TrialNr == min(trials)]
    dt_ioi_first <- rbind(dt_ioi_first, current)
  }
}

dt_kot_first <- data.table()
for (subnr in unique(info$SubNr)){
  for (category in unique(info[SubNr == subnr]$Category)){
    trials <- unique(info[SubNr == subnr & Category == category]$TrialNr)
    current <- dt_kot[SubNr == subnr & Category == category & TrialNr == min(trials)]
    dt_kot_first <- rbind(dt_kot_first, current)
  }
}

dt_vel_first <- data.table()
for (subnr in unique(info$SubNr)){
  for (category in unique(info[SubNr == subnr]$Category)){
    trials <- unique(info[SubNr == subnr & Category == category]$TrialNr)
    current <- dt_vel[SubNr == subnr & Category == category & TrialNr == min(trials)]
    dt_vel_first <- rbind(dt_vel_first, current)
  }
}

dt_vel_diff_first <- data.table()
for (subnr in unique(info$SubNr)){
  for (category in unique(info[SubNr == subnr]$Category)){
    trials <- unique(info[SubNr == subnr & Category == category]$TrialNr)
    current <- dt_vel_diff[SubNr == subnr & Category == category & TrialNr == min(trials)]
    dt_vel_diff_first <- rbind(dt_vel_diff_first, current)
  }
}
```

# IOI 
## 1. Individual

```{r ioi}
# for each individual
ioi_trial <- dt_ioi_first[, .(N = .N, Mean = mean(IOI), SD = sd(IOI)), by = .(SubNr, TrialNr, Stimuli, Articulation2, Dynamics2)]

ioi <- ioi_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Articulation2, Dynamics2)]
ioi
```

### Plot
#### Boxplot

```{r ioi-plot, fig.width = 4.5}
ggboxplot(ioi_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Stimuli, Articulation2, Dynamics2)], "Articulation2", "Mean", color = "Dynamics2", add = "jitter", facet.by = "SubNr", xlab = "Articulation", ylab = "IOIs (ms)", title = "IOI")
```

## 2. All - group

```{r ioi-all}
# group mean
ioi_all <- ioi[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation2, Dynamics2)]
ioi_all
```

### Plot
#### Box plot

```{r ioi-all-plot}
ggboxplot(ioi, "Articulation2", "Mean", color = "Dynamics2", add = "jitter", xlab = "Articulation", ylab = "IOIs (ms)", title = "IOI")
```

## 3. Sequence plots

```{r seq-ioi, fig.width = 7, fig.height = 2}
ioi_seq <- dt_ioi[, .(N = .N, Mean = mean(IOI), SD = sd(IOI)), by = .(SubNr, Category, Articulation, Dynamics, Interval)]

ggline(ioi_seq, x = "Interval", y = "Mean", add = "mean_se", position = position_dodge(.2), shape = "Category", color = "Category", xlab = "Interval", ylab = "IOIs (ms)", title = "IOI") + scale_x_continuous(breaks = seq(1,71,1))
```

## 4. Stats

```{r}
aov_ez(
  data = ioi,
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```


# Articulation
## 1. Individual

```{r kot, echo = FALSE}
# for each individual
kot_trial <- dt_kot_first[Articulation == "Legato" | Articulation == "Staccato", .(N = .N, Mean = mean(KOT), SD = sd(KOT)), by = .(SubNr, TrialNr, Stimuli, Articulation2, Dynamics2, Articulation)]

kot <- kot_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Articulation2, Dynamics2, Articulation)]
kot
```

### Plot
#### Boxplot

```{r kot-plot,  echo = FALSE, fig.width = 4.5}
ggboxplot(kot_trial[Articulation == "Legato"], "Articulation2", "Mean", color = "Dynamics2", add = "jitter", facet.by = "SubNr", xlab = "Articulation", ylab = "KOT (ms)", title = "KOT (Legato)")

ggboxplot(kot_trial[Articulation == "Staccato"], "Articulation2", "Mean", color = "Dynamics2", add = "jitter", facet.by = "SubNr", xlab = "Articulation", ylab = "KOT (ms)", title = "KOT (Staccato)")
```

## 2. All - group

```{r kot-all, echo = FALSE}
# group mean
kot_all <- kot[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation2, Dynamics2, Articulation)]
kot_all
```

### Plot
#### Boxplot

```{r kot-all-plot, echo = FALSE}
ggboxplot(kot[Articulation == "Legato"], "Articulation2", "Mean", color = "Dynamics2", add = "jitter", xlab = "Articulation", ylab = "KOT (ms)", title = "KOT (Legato)")

ggboxplot(kot[Articulation == "Staccato"], "Articulation2", "Mean", color = "Dynamics2", add = "jitter", xlab = "Articulation", ylab = "KOT (ms)", title = "KOT (Staccato)")
```

## 3. Sequence plots

```{r seq-kot, fig.width = 7, fig.height = 2}
kot_seq <- dt_kot[, .(N = .N, Mean = mean(KOT), SD = sd(KOT)), by = .(SubNr, Category, Articulation, Dynamics, Interval)]

ggline(kot_seq, x = "Interval", y = "Mean", add = "mean_se", position = position_dodge(.2), shape = "Category", color = "Category", xlab = "Interval", ylab = "KOT (ms)", title = "KOT") + scale_x_continuous(breaks = seq(1,71,1))
```

## 4. Stats

1) Legato

```{r}
aov_ez(
  data = kot[Articulation == "Legato"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```

2) Staccato

```{r}
aov_ez(
  data = kot[Articulation == "Staccato"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```

# Dynamics
## 1. Individual

```{r vel, echo = FALSE}
# for each individual
vel_trial <- dt_vel_first[Dynamics != "NA", .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, TrialNr, Stimuli, Articulation2, Dynamics2, Dynamics)]

vel <- vel_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Articulation2, Dynamics2, Dynamics)]
vel
```

### Plot
#### Boxplot

```{r vel-plot, echo = FALSE, fig.width = 4.5}
ggboxplot(vel_trial[Dynamics == "Forte"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", facet.by = "SubNr", xlab = "SubNr", ylab = "Velocity", title = "KV (Forte)")

ggboxplot(vel_trial[Dynamics == "Piano"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", facet.by = "SubNr", xlab = "SubNr", ylab = "Velocity", title = "KV (Piano)")
```

## 2. All - group

```{r vel-all, echo = FALSE}
# group mean
vel_all <- vel[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation2, Dynamics2, Dynamics)]
vel_all
```

### Plot
#### Boxplot

```{r vel-all-plot,  echo = FALSE}
ggboxplot(vel[Dynamics == "Forte"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", xlab = "Dynamics", ylab = "Velocity", title = "KV (Forte)")

ggboxplot(vel[Dynamics == "Piano"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", xlab = "Dynamics", ylab = "Velocity", title = "KV (Piano)")
```

## 3. Sequence plots

```{r seq-vel, fig.width = 7, fig.height = 2}
vel_seq <- dt_vel[, .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Category, Articulation, Dynamics, RowNr)]

ggline(vel_seq, x = "RowNr", y = "Mean", add = "mean_se", position = position_dodge(.2), shape = "Category", color = "Category", xlab = "Note Nr", ylab = "Velocity (0-127)", title = "Velocity") + scale_x_continuous(breaks = seq(1,71,1))
```

## 4. Stats

1) Forte

```{r}
aov_ez(
  data = vel[Dynamics == "Forte"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```

2) Piano

```{r}
aov_ez(
  data = vel[Dynamics == "Piano"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```

# Dynamics Difference
## 1. Individual

```{r vel-diff, echo = FALSE}
# for each individual
vel_diff_trial <- dt_vel_diff_first[Dynamics == "FtoP" | Dynamics == "PtoF", .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, TrialNr, Stimuli, Articulation2, Dynamics2, Dynamics)]

vel_diff <- vel_diff_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean)), by = .(SubNr, Articulation2, Dynamics2, Dynamics)]
vel_diff
```

### Plot
#### Boxplot

```{r vel-diff-plot, echo = FALSE, fig.width = 4.5}
ggboxplot(vel_diff_trial[Dynamics == "FtoP"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", facet.by = "SubNr", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV-Diff (FtoP)")

ggboxplot(vel_diff_trial[Dynamics == "PtoF"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", facet.by = "SubNr", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV-Diff (PtoF)")
```

## 2. All - group
```{r vel-diff-all, echo = FALSE}
# group mean
vel_diff_all <- vel_diff[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N), Median = median(Mean), IQR = IQR(Mean)), by = .(Articulation2, Dynamics2, Dynamics)]
vel_diff_all
```

### Plot
#### Boxplot

```{r vel-diff-all-plot,  echo = FALSE}
ggboxplot(vel_diff[Dynamics == "FtoP"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV (FtoP)")

ggboxplot(vel_diff[Dynamics == "PtoF"], "Dynamics2", "Mean", color = "Articulation2", add = "jitter", xlab = "Dynamics", ylab = "Velocity Difference", title = "KV (PtoF)")
```

## 3. Sequence plots

```{r seq-vel-diff, fig.width = 7, fig.height = 2}
vel_diff_seq <- dt_vel_diff[, .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, Category, Articulation, Dynamics, Interval)]

ggline(vel_diff_seq, x = "Interval", y = "Mean", add = "mean_se", position = position_dodge(.2), shape = "Category", color = "Category", xlab = "Interval", ylab = "Difference", title = "Velocity Difference") + scale_x_continuous(breaks = seq(1,71,1))
```

## 4. Stats

1) FtoP

```{r}
aov_ez(
  data = vel_diff[Dynamics == "FtoP"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```

2) PtoF

```{r}
aov_ez(
  data = vel_diff[Dynamics == "PtoF"],
  id = "SubNr",
  dv = "Mean",
  within = c("Articulation2", "Dynamics2")
)
```
